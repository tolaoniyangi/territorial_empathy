<!DOCTYPE html>
<html lang="en">
    <meta charset="utf-8">

    <head>
        <title> COVID Deaths </title>

        <!-- Google fonts code -->
            <link href="https://fonts.googleapis.com/css?family=Noto Serif|Dosis|Poppins|Abel|Roboto" rel="stylesheet">

        <!-- Load d3.js to read csv, charts.js to make chart, jquery -->
        <script src='https://d3js.org/d3.v5.min.js' charset='utf-8'></script>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"> </script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        
        <!-- <script src="js/animation.js"></script> -->
        <link rel="stylesheet" type="text/css" href="css/style.css">

    </head>

    <body>
        <!-- <div id="title">How did COVID affect different races?</div> -->
        <!-- <div id="legend"> -->
            <!-- <div class="item infections">Infections</div>
            <div class="item hospitalizations">Hospitalizations</div>
            <div class="item deaths">Deaths</div> -->
        <!-- </div> -->
        <canvas id="chart" width="800" height="400"></canvas>
   </body>

    <script type="text/javascript">
        Chart.defaults.global.defaultFontFamily = 'Noto Serif, serif';
        Chart.defaults.global.defaultFontColor = '#333';
        Chart.defaults.global.defaultFontStyle = 'normal';
        // Chart.defaults.global.defaultFontSize = '24';

        function makeChart(covidByRace) {
            var raceLabels = covidByRace.map(function(d) {return d.RACE_GROUP});
            var infectedData = covidByRace.map(function(d) {return +d.CASE_RATE_ADJ});
            var hospitalizedData = covidByRace.map(function(d) {return +d.HOSPITALIZED_RATE_ADJ});
            var diedData = covidByRace.map(function(d) {return +d.DEATH_RATE_ADJ});
            // var raceColors = covidByRace.map(function(d) {return d.RACE_GROUP === 'Asian/Pacific-Islander' ? '#F15F36' : '#19A0AA';});

            var chart = new Chart('chart', {
                type: 'radar',
                backgroundColor: "#F5DEB3",
                options: {
                    responsive:true,
                    maintainAspectRatio: true,
                    legend: {
                        display: true,
                        align: 'center',
                        position: 'left',
                        labels:{
                            fontColor: 'rgb(128, 158, 157)',
                            fontSize: 14,
                            padding: 5,
                            fontStyle: 'italic',
                        },
                        onHover: function(e) {
                            e.target.style.cursor = 'pointer';
                        },
                    },
                    hover: {
                        onHover: function(e) {
                            var point = this.getElementAtEvent(e);
                            if (point.length) e.target.style.cursor = 'pointer';
                            else e.target.style.cursor = 'default';
                        }
                    },
                    title: {
                        display: false,
                        align: 'center',
                        position: 'top',
                        text: 'How did COVID affect different races?',
                        fontSize: 24,
                        padding: 12,
                        fontColor: '#fff',
                    },
                    scale: {
                        ticks: {
                            backdropColor: 'black', // should render black behind the text
                            fontColor: 'rgba(128, 158, 157, 0.7)',

                        },
                        pointLabels :{
                            fontStyle: "normal",
                            // fontFamily:'Roboto',
                            fontSize: '16',
                            fontColor: '#fff',
                        },
                        gridLines: {
                            color: 'rgba(128, 158, 157, .3)',
                        },
                    },
                    tooltips: {
                        enabled: true,
                        callbacks: {
                            // label: function(tooltipItem, data) {
                            //     return data.datasets[tooltipItem.datasetIndex].label + ' : ' + data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];
                            // },
                            label: function(tooltipItem, data) {
                                var label = data.datasets[tooltipItem.datasetIndex].label || '';

                                if (label) {
                                    label += ': ';
                                }

                                label += Math.round(tooltipItem.yLabel * 100) / 100;
                                return label;
                                // return label + "%";
                            },
                        },
                    },
                },
                data: {
                    labels: raceLabels,
                    datasets: [
                        {
                            data: infectedData,
                            label: "Infection Rate",
                            fill: true,
                            backgroundColor: 'rgba(25,160,170,.2)',
                            borderColor: 'rgba(25,160,170,1)',
                            pointBorderColor: "rgba(255, 255, 255, 0.8)",
                            pointBackgroundColor: "rgba(25,160,170,1)",
                            pointHoverRadius: 10,
                            pointRadius: 4,
                        }, {
                            data: hospitalizedData,
                            label: "Hospitalization Rate",
                            backgroundColor: 'rgba(241,95,54,.2)',
                            borderColor: 'rgba(241,95,54,1)',
                            pointBorderColor: "rgba(255, 255, 255, 0.8)",
                            pointBackgroundColor: "rgba(241,95,54,1)",
                            pointHoverRadius: 10,
                            pointRadius: 4,
                        }, {
                            data: diedData,
                            label: "Death Rate",
                            backgroundColor: 'rgba(255,255,0,.2)',
                            borderColor: 'rgba(255,255,0,1)',
                            pointBorderColor: "rgba(255, 255, 255, 0.8)",
                            pointBackgroundColor: "rgba(255,255,0,1)",
                            pointHoverRadius: 10,
                            pointRadius: 4,
                        }
                    ]
                }
            })
        }

        // Request data using D3
        d3.csv('https://raw.githubusercontent.com/nychealth/coronavirus-data/3f21405a00bf7c93db5a5209b44886882feb30a6/by-race.csv')
            .then(makeChart);

    </script> 

</html>

